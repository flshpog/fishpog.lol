<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphing Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .calculator-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 1200px;
            width: 100%;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            min-height: 700px;
        }

        .controls-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .controls-panel h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }

        .function-input {
            margin-bottom: 20px;
        }

        .function-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .function-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .function-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .color-picker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: transform 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #333;
            transform: scale(1.15);
        }

        .graph-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 1px solid #e9ecef;
        }

        canvas {
            display: block;
            cursor: grab;
        }

        canvas:active {
            cursor: grabbing;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .control-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .range-input {
            margin-top: 15px;
        }

        .range-input label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .range-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }

        .functions-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .function-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .function-display {
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .remove-btn {
            padding: 5px 10px;
            font-size: 12px;
            background: #dc3545;
            min-width: auto;
            flex: none;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .calculator-container {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .controls-panel {
                order: 2;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="controls-panel">
            <h2>ðŸ“Š Graph Functions</h2>
            
            <div class="function-input">
                <label for="function-input">Enter Function (y = ...)</label>
                <input type="text" id="function-input" placeholder="x^2, sin(x), 2*x + 1" />
                <div class="color-picker">
                    <div class="color-option selected" style="background-color: #3498db;" data-color="#3498db"></div>
                    <div class="color-option" style="background-color: #e74c3c;" data-color="#e74c3c"></div>
                    <div class="color-option" style="background-color: #2ecc71;" data-color="#2ecc71"></div>
                    <div class="color-option" style="background-color: #f39c12;" data-color="#f39c12"></div>
                    <div class="color-option" style="background-color: #9b59b6;" data-color="#9b59b6"></div>
                </div>
            </div>

            <div class="controls">
                <button onclick="addFunction()">Add Function</button>
                <div class="control-group">
                    <button onclick="zoomIn()">Zoom In</button>
                    <button onclick="zoomOut()">Zoom Out</button>
                </div>
                <button onclick="resetView()">Reset View</button>
                <button onclick="clearAll()">Clear All</button>
            </div>

            <div class="range-input">
                <label>X Range:</label>
                <input type="number" id="x-min" placeholder="Min X" value="-10">
                <input type="number" id="x-max" placeholder="Max X" value="10">
            </div>

            <div class="range-input">
                <label>Y Range:</label>
                <input type="number" id="y-min" placeholder="Min Y" value="-10">
                <input type="number" id="y-max" placeholder="Max Y" value="10">
            </div>

            <div class="functions-list" id="functions-list">
                <h4>Active Functions:</h4>
            </div>
        </div>

        <div class="graph-container">
            <canvas id="graph-canvas" width="800" height="600"></canvas>
        </div>
    </div>

    <script>
        class GraphingCalculator {
            constructor() {
                this.canvas = document.getElementById('graph-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.functions = [];
                this.colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
                this.selectedColor = '#3498db';
                
                // View parameters
                this.xMin = -10;
                this.xMax = 10;
                this.yMin = -10;
                this.yMax = 10;
                
                this.setupCanvas();
                this.setupEventListeners();
                this.draw();
            }

            setupCanvas() {
                const container = this.canvas.parentElement;
                const rect = container.getBoundingClientRect();
                this.canvas.width = rect.width - 2;
                this.canvas.height = rect.height - 2;
            }

            setupEventListeners() {
                let isDragging = false;
                let lastX, lastY;

                this.canvas.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    lastX = e.offsetX;
                    lastY = e.offsetY;
                });

                this.canvas.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        const deltaX = e.offsetX - lastX;
                        const deltaY = e.offsetY - lastY;
                        
                        const xRange = this.xMax - this.xMin;
                        const yRange = this.yMax - this.yMin;
                        
                        const xMove = -(deltaX / this.canvas.width) * xRange;
                        const yMove = (deltaY / this.canvas.height) * yRange;
                        
                        this.xMin += xMove;
                        this.xMax += xMove;
                        this.yMin += yMove;
                        this.yMax += yMove;
                        
                        this.updateRangeInputs();
                        this.draw();
                        
                        lastX = e.offsetX;
                        lastY = e.offsetY;
                    }
                });

                this.canvas.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;
                    this.zoom(zoomFactor);
                });

                // Color picker
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelector('.color-option.selected').classList.remove('selected');
                        option.classList.add('selected');
                        this.selectedColor = option.dataset.color;
                    });
                });

                // Input function on Enter
                document.getElementById('function-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addFunction();
                    }
                });

                // Range inputs
                ['x-min', 'x-max', 'y-min', 'y-max'].forEach(id => {
                    document.getElementById(id).addEventListener('change', () => {
                        this.updateRangeFromInputs();
                        this.draw();
                    });
                });
            }

            updateRangeInputs() {
                document.getElementById('x-min').value = this.xMin.toFixed(2);
                document.getElementById('x-max').value = this.xMax.toFixed(2);
                document.getElementById('y-min').value = this.yMin.toFixed(2);
                document.getElementById('y-max').value = this.yMax.toFixed(2);
            }

            updateRangeFromInputs() {
                this.xMin = parseFloat(document.getElementById('x-min').value) || -10;
                this.xMax = parseFloat(document.getElementById('x-max').value) || 10;
                this.yMin = parseFloat(document.getElementById('y-min').value) || -10;
                this.yMax = parseFloat(document.getElementById('y-max').value) || 10;
            }

            zoom(factor) {
                const centerX = (this.xMin + this.xMax) / 2;
                const centerY = (this.yMin + this.yMax) / 2;
                const xRange = (this.xMax - this.xMin) * factor / 2;
                const yRange = (this.yMax - this.yMin) * factor / 2;
                
                this.xMin = centerX - xRange;
                this.xMax = centerX + xRange;
                this.yMin = centerY - yRange;
                this.yMax = centerY + yRange;
                
                this.updateRangeInputs();
                this.draw();
            }

            screenToGraph(screenX, screenY) {
                const x = this.xMin + (screenX / this.canvas.width) * (this.xMax - this.xMin);
                const y = this.yMax - (screenY / this.canvas.height) * (this.yMax - this.yMin);
                return { x, y };
            }

            graphToScreen(x, y) {
                const screenX = ((x - this.xMin) / (this.xMax - this.xMin)) * this.canvas.width;
                const screenY = ((this.yMax - y) / (this.yMax - this.yMin)) * this.canvas.height;
                return { x: screenX, y: screenY };
            }

            drawGrid() {
                this.ctx.strokeStyle = '#e0e0e0';
                this.ctx.lineWidth = 1;

                const xStep = this.getStepSize(this.xMax - this.xMin);
                const yStep = this.getStepSize(this.yMax - this.yMin);

                // Vertical lines
                for (let x = Math.ceil(this.xMin / xStep) * xStep; x <= this.xMax; x += xStep) {
                    const pos = this.graphToScreen(x, 0);
                    this.ctx.beginPath();
                    this.ctx.moveTo(pos.x, 0);
                    this.ctx.lineTo(pos.x, this.canvas.height);
                    this.ctx.stroke();
                }

                // Horizontal lines
                for (let y = Math.ceil(this.yMin / yStep) * yStep; y <= this.yMax; y += yStep) {
                    const pos = this.graphToScreen(0, y);
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, pos.y);
                    this.ctx.lineTo(this.canvas.width, pos.y);
                    this.ctx.stroke();
                }
            }

            drawAxes() {
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 2;

                // X-axis
                if (this.yMin <= 0 && this.yMax >= 0) {
                    const y = this.graphToScreen(0, 0).y;
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }

                // Y-axis
                if (this.xMin <= 0 && this.xMax >= 0) {
                    const x = this.graphToScreen(0, 0).x;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
            }

            getStepSize(range) {
                const magnitude = Math.pow(10, Math.floor(Math.log10(range)));
                const normalized = range / magnitude;
                
                if (normalized <= 2) return magnitude * 0.2;
                if (normalized <= 5) return magnitude * 0.5;
                return magnitude;
            }

            parseExpression(expr) {
                // Simple math expression parser
                expr = expr.replace(/\s/g, '');
                expr = expr.replace(/\^/g, '**');
                expr = expr.replace(/sin/g, 'Math.sin');
                expr = expr.replace(/cos/g, 'Math.cos');
                expr = expr.replace(/tan/g, 'Math.tan');
                expr = expr.replace(/log/g, 'Math.log10');
                expr = expr.replace(/ln/g, 'Math.log');
                expr = expr.replace(/sqrt/g, 'Math.sqrt');
                expr = expr.replace(/abs/g, 'Math.abs');
                expr = expr.replace(/pi/g, 'Math.PI');
                expr = expr.replace(/e/g, 'Math.E');
                
                return expr;
            }

            evaluateFunction(expr, x) {
                try {
                    const parsedExpr = this.parseExpression(expr);
                    return Function('x', `return ${parsedExpr}`)(x);
                } catch (e) {
                    return NaN;
                }
            }

            plotFunction(func) {
                this.ctx.strokeStyle = func.color;
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();

                let firstPoint = true;
                const step = (this.xMax - this.xMin) / this.canvas.width * 2;

                for (let x = this.xMin; x <= this.xMax; x += step) {
                    const y = this.evaluateFunction(func.expression, x);
                    
                    if (!isNaN(y) && isFinite(y)) {
                        const pos = this.graphToScreen(x, y);
                        
                        if (pos.y >= 0 && pos.y <= this.canvas.height) {
                            if (firstPoint) {
                                this.ctx.moveTo(pos.x, pos.y);
                                firstPoint = false;
                            } else {
                                this.ctx.lineTo(pos.x, pos.y);
                            }
                        } else {
                            firstPoint = true;
                        }
                    } else {
                        firstPoint = true;
                    }
                }
                
                this.ctx.stroke();
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.drawGrid();
                this.drawAxes();
                
                this.functions.forEach(func => {
                    this.plotFunction(func);
                });
            }

            addFunction(expression, color = this.selectedColor) {
                if (!expression.trim()) return;
                
                const func = {
                    id: Date.now(),
                    expression: expression,
                    color: color
                };
                
                this.functions.push(func);
                this.updateFunctionsList();
                this.draw();
            }

            removeFunction(id) {
                this.functions = this.functions.filter(f => f.id !== id);
                this.updateFunctionsList();
                this.draw();
            }

            updateFunctionsList() {
                const list = document.getElementById('functions-list');
                list.innerHTML = '<h4>Active Functions:</h4>';
                
                this.functions.forEach(func => {
                    const item = document.createElement('div');
                    item.className = 'function-item';
                    item.innerHTML = `
                        <span class="function-display" style="color: ${func.color}">y = ${func.expression}</span>
                        <button class="remove-btn" onclick="calc.removeFunction(${func.id})">Ã—</button>
                    `;
                    list.appendChild(item);
                });
            }

            resetView() {
                this.xMin = -10;
                this.xMax = 10;
                this.yMin = -10;
                this.yMax = 10;
                this.updateRangeInputs();
                this.draw();
            }

            clearAll() {
                this.functions = [];
                this.updateFunctionsList();
                this.draw();
            }
        }

        // Initialize calculator
        const calc = new GraphingCalculator();

        // Global functions for button events
        function addFunction() {
            const input = document.getElementById('function-input');
            calc.addFunction(input.value);
            input.value = '';
        }

        function zoomIn() {
            calc.zoom(0.8);
        }

        function zoomOut() {
            calc.zoom(1.2);
        }

        function resetView() {
            calc.resetView();
        }

        function clearAll() {
            calc.clearAll();
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            setTimeout(() => {
                calc.setupCanvas();
                calc.draw();
            }, 100);
        });
    </script>
</body>
</html>